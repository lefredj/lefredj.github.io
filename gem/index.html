
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="polyhedra.js"></script> -->
    <script type="importmap">
    {
      "imports": {
	"three": "https://unpkg.com/three@0.160.0/build/three.module.js",
	"three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
	"mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';
      const mindarThree = new MindARThree({
	  container: document.querySelector("#container"),
	  imageTargetSrc: "./targets.mind",
          filterMinCF: 0.0001,
          filterBeta: 0.001,
      });
      const {renderer, scene, camera} = mindarThree;
      const anchor = mindarThree.addAnchor(0);

      //const geometry = new THREE.IcosahedronGeometry(0.3, 0);
      
      const vertices = new Float32Array([
	  0.2,0.2,0.1,
	  0.2,-0.2,0.1,
	  -0.2,-0.2,0.1,
	  -0.2,0.2,0.1,
	  0.2,0.2,-0.1,
	  0.2,-0.2,-0.1,
	  -0.2,-0.2,-0.1,
	  -0.2,0.2,-0.1,
	  0.3,0.4,0,
	  0.3,-0.4,0,
	  -0.3,-0.4,0,
	  -0.3,0.4,0,
	  0.4,0.3,0,
	  0.4,-0.3,0,
	  -0.4,-0.3,0,
	  -0.4,0.3,0,
   ]);

      // Define faces using vertex indices (each face is a triangle)
      const indices = [
	  0,2,1,
	  0,3,2,
	  4,5,6,
	  4,6,7,
	  4,8,12,
	  5,13,9,
	  6,10,14,
	  7,15,11,
	  0,12,8,
	  1,9,13,
	  2,14,10,
	  3,11,15,
	  0,1,13,
	  0,13,12,
	  1,2,10,
	  1,10,9,
	  2,3,15,
	  2,15,14,
	  3,0,8,
	  3,8,11,

	  4,13,5,
	  4,12,13,
	  5,10,6,
	  5,9,10,
	  6,15,7,
	  6,14,15,
	  7,8,4,
	  7,11,8

      ];

      
      const color = 0x00ffaa
      const geometry = new THREE.BufferGeometry();
      geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
      geometry.setIndex(indices);
      geometry.computeVertexNormals(); // Calculate normals for shading

      const material = new THREE.MeshPhysicalMaterial({
	  transmission: 1, // Add transparency
	  metalness: 0.05,
	  ior: 1.2,
	  roughness: 0.,
	  thickness: 0.2, // Add refraction!
	  //color:0xff00ff,
	  color:color,

      });
      const polyhedron = new THREE.Mesh(geometry, material)
      polyhedron.rotation.x = Math.PI/6;
      polyhedron.scale.set(0.5,0.5,0.5);
      polyhedron.position.set(0,0,0.5)
      anchor.group.add(polyhedron);

      const pointlight = new THREE.PointLight(color, 1);
      pointlight.position.set(0,0,0.5);
      anchor.group.add(pointlight);

      
      const light = new THREE.DirectionalLight(0xfff0dd, 1);
      light.position.set(0, 5, 10);
      anchor.group.add(light);

      const bgTexture = new THREE.TextureLoader().load("assets/texture.png");
      const bgGeometry = new THREE.PlaneGeometry(1, 1);
      const bgMaterial = new THREE.MeshBasicMaterial({ map: bgTexture });
      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.position.set(0, 0, 0);
      anchor.group.add(bgMesh);

      const cyl = new THREE.CylinderGeometry(0.3,0.3,0.05,64)
      const materialc = new THREE.MeshPhysicalMaterial({
	  transmission: 1, // Add transparency
	  metalness: 0.4,
	  ior: 1.2,
	  roughness: 0.5,
	  //thickness: 0.3, // Add refraction!
	  //color:0xffdddd,

      });
      const cylinder = new THREE.Mesh(cyl,materialc)
      cylinder.rotation.x = Math.PI/2
      cylinder.position.set(0,0,0.025)
      anchor.group.add(cylinder)


      const start = async() => {
	  await mindarThree.start();
	  renderer.setAnimationLoop(() => {
	      polyhedron.rotation.y += 0.01;

	      renderer.render(scene, camera);
	  });
      }

      window.onload = () => {
	  document.body.requestFullscreen();
	  start();
      };



    </script>
    <style>
      body {
	  margin: 0;
	  overflow: hidden;
      }
      #container {
	width: 100vw;
	height: 100vh;
	position: relative;
	overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="container">
    </div>
  </body>
</html>
