
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>lefredj's gem</title>
    <script type="importmap">

      {
      "imports": {
	"three": "https://unpkg.com/three@0.158.0/build/three.module.js",
	"three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/",
	"mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
    <script type="module">
      function getParams() {
	  var idx = document.URL.indexOf('?');
	  var params = new Array();
	  if (idx != -1) {
	      var pairs = document.URL.substring(idx+1, document.URL.length).split('&');
	      for (var i=0; i<pairs.length; i++) {
		  var nameVal = pairs[i].split('=');
		  params[nameVal[0]] = nameVal[1];
	      }
	  } else {
	      params["gem"] = '234'
	  }
	  return params;
      }
      var params = getParams();
      var gem = params["gem"]

      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';
      import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
      const mindarThree = new MindARThree({
	  container: document.querySelector("#container"),
	  imageTargetSrc: "./assets/targets_"+gem+".mind",
          filterMinCF: 0.0001,
          filterBeta: 0.001,
      });
      const {renderer, scene, camera} = mindarThree;
      const anchor = mindarThree.addAnchor(0);


      const lights = new Array();
      for( var u = 0; u < 20; u ++) {
	  lights[u] = new THREE.DirectionalLight(new THREE.Color(0.5+0.5*Math.random(),0.5+0.5*Math.random(),0.5+0.5*Math.random()), 1);
	  lights[u].position.set(5*Math.cos(2*Math.PI*u/20),5*Math.sin(2*Math.PI*u/20),2+0.5*Math.random())
	  anchor.group.add(lights[u])
      }
      // const light = new THREE.DirectionalLight(0xffff00, 1);
      // light.position.set(-5, -5, 5);
      // anchor.group.add(light);
      // const light1 = new THREE.DirectionalLight(0xff00ff, 1);
      // light1.position.set(-5, 5, 5);
      // anchor.group.add(light1);
      // const light2 = new THREE.DirectionalLight(0x00ffff, 1);
      // light2.position.set(5, -5, 5);
      // anchor.group.add(light2);
      // const light3 = new THREE.DirectionalLight(0xffffff, 1);
      // light3.position.set(5, 5, 5);
      // anchor.group.add(light3);

      // const light_ = new THREE.DirectionalLight(0xffff00, 1);
      // light_.position.set(0,5, 5);
      // anchor.group.add(light_);
      // const light1_ = new THREE.DirectionalLight(0xff00ff, 1);
      // light1_.position.set(5, 0, 5);
      // anchor.group.add(light1_);
      // const light2_ = new THREE.DirectionalLight(0x00ffff, 1);
      // light2_.position.set(-5, 0, 5);
      // anchor.group.add(light2_);
      // const light3_ = new THREE.DirectionalLight(0xffffff, 1);
      // light3_.position.set(0, -5, 5);
      // anchor.group.add(light3_);

      const bgTexture = new THREE.TextureLoader().load("assets/texture.png");
      const bgGeometry = new THREE.PlaneGeometry(1, 1);
      const bgMaterial = new THREE.MeshBasicMaterial({ map: bgTexture });
      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.position.set(0, 0, 0);
      anchor.group.add(bgMesh);

      const cyl = new THREE.CylinderGeometry(0.3,0.3,0.05,64)
      const materialc = new THREE.MeshPhysicalMaterial({
	  transmission: 1, // Add transparency
	  metalness: 0.4,
	  ior: 1.2,
	  roughness: 0.5,
      });
      const cylinder = new THREE.Mesh(cyl,materialc)
      cylinder.rotation.x = Math.PI/2
      cylinder.position.set(0,0,0.025)
      anchor.group.add(cylinder)

      const loader = new GLTFLoader();
let model;
// Load a glTF resource
loader.load(
	// resource URL
	'assets/gem_'+gem+'.gltf',
	// called when the resource is loaded
	function ( gltf ) {

        model = gltf.scene;

        // Change position
        model.position.set(0, 0, 1);
        model.scale.set(0.5, 0.5, 0.5); // Scale down by a factor of 0.5
		anchor.group.add( model );

		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object

	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
);

      
      window.addEventListener('click', onclick, false);
      //renderer.domElement.addEventListener("click", onclick, true);
      function onclick(event) {
          let newloc = "https://www.falj.net/";
          window.location.replace(newloc);
	  //alert('Clicked on the model!');
	  //console.log('click')
      }


      const start = async() => {
	  await mindarThree.start();
	  renderer.setAnimationLoop(() => {
	      if( model ) {
		  //model.rotation.x += 0.001;
		  model.rotation.y += 0.02;
	      }
	      renderer.render(scene, camera);
	  });
      }

      window.onload = () => {
	  document.body.requestFullscreen();
	  start();
      };


      
    </script>
    <style>
      body {
	  margin: 0;
	  overflow: hidden;
      }
      #container {
	width: 100vw;
	height: 100vh;
	position: relative;
	overflow: hidden;
      }
    </style>
  </head>
  <body>
    
    <div id="container">
    </div>
  </body>
</html>
