
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>lefredj's gem</title>
    <script type="importmap">

      {
      "imports": {
	"three": "https://unpkg.com/three@0.158.0/build/three.module.js",
	"three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/",
	"mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
    <script type="module">
      function getParams() {
	  var idx = document.URL.indexOf('?');
	  var params = new Array();
	  if (idx != -1) {
	      var pairs = document.URL.substring(idx+1, document.URL.length).split('&');
	      for (var i=0; i<pairs.length; i++) {
		  var nameVal = pairs[i].split('=');
		  params[nameVal[0]] = nameVal[1];
	      }
	  } else {
	      params["gem"] = '234'
	  }
	  return params;
      }
      var params = getParams();
      var gem = params["gem"]

      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';
      import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
      const mindarThree = new MindARThree({
	  container: document.querySelector("#container"),
	  imageTargetSrc: "./assets/targets_"+gem+".mind",
          filterMinCF: 0.0001,
          filterBeta: 0.001,
      });
      const {renderer, scene, camera} = mindarThree;
      const anchor = mindarThree.addAnchor(0);

      const lights = new Array();
      var n = 20
       for( var u = 0; u < n; u ++) {
           lights[u] = new THREE.DirectionalLight(new THREE.Color(Math.random(),Math.random(),Math.random()), 1);
	   var theta = Math.PI*2*u/n
	   var r = 2+10*Math.random()
           lights[u].position.set(r*Math.cos(2*Math.PI*u/n)*Math.sin(theta),
        			  r*Math.sin(2*Math.PI*u/n)*Math.sin(theta),
        			  r*Math.cos(theta)
        			 )
           scene.add(lights[u])
        }


      // const lights = new Array();
      // for( var u = 0; u < 20; u ++) {
      // 	  lights[u] = new THREE.DirectionalLight(new THREE.Color(0.5+0.5*Math.random(),0.5+0.5*Math.random(),0.5+0.5*Math.random()), 1);
      // 	  var theta = (1+Math.random())*Math.PI/3
      // 	  lights[u].position.set(5*Math.cos(2*Math.PI*u/20)*Math.cos(theta),
      // 				 5*Math.sin(2*Math.PI*u/20)*Math.cos(theta),
      // 				 5*Math.sin(theta)
      // 				 //2+0.5*Math.random()
      // 				)
      // 	  anchor.group.add(lights[u])
      // }

      const bgTexture = new THREE.TextureLoader().load("assets/texture.png");
      const bgGeometry = new THREE.PlaneGeometry(1, 1);
      const bgMaterial = new THREE.MeshBasicMaterial({ map: bgTexture });
      const bgMesh = new THREE.Mesh(bgGeometry, bgMaterial);
      bgMesh.position.set(0, 0, 0);
      anchor.group.add(bgMesh);

      // const cyl = new THREE.CylinderGeometry(0.3,0.3,0.05,64)
      // const materialc = new THREE.MeshPhysicalMaterial({
      // 	  transmission: 1, // Add transparency
      // 	  metalness: 0.4,
      // 	  ior: 1.2,
      // 	  roughness: 0.5,
      // });
      // const cylinder = new THREE.Mesh(cyl,materialc)
      // cylinder.rotation.x = Math.PI/2
      // cylinder.position.set(0,0,0.025)
      // anchor.group.add(cylinder)

      const loader = new GLTFLoader();
      let model;
      // Load a glTF resource
      loader.load(
	// resource URL
	'assets/gem_'+gem+'.gltf',
	// called when the resource is loaded
	function ( gltf ) {

        model = gltf.scene;

        // Change position
        model.position.set(0, 0, 1);
        model.scale.set(0.5, 0.5, 0.5); // Scale down by a factor of 0.5
		anchor.group.add( model );

		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object

	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
);

      
      window.addEventListener('click', onclick, false);
      //renderer.domElement.addEventListener("click", onclick, true);
      function onclick(event) {
          let newloc = "https://lefredj.github.io/gem/nft.html?gem="+gem;
          window.location.replace(newloc);
      }


      const start = async() => {
	  await mindarThree.start();
	  renderer.setAnimationLoop(() => {
	      if( model ) {
		  //model.rotation.x += 0.001;
		  model.rotation.y += 0.02;
	      }
	      renderer.render(scene, camera);
	  });
      }

      window.onload = () => {
	  document.body.requestFullscreen();
	  start();
      };


      
    </script>
    <style>
      body {
	  margin: 0;
	  overflow: hidden;
      }
      #container {
	width: 100vw;
	height: 100vh;
	position: relative;
	overflow: hidden;
      }
    </style>
  </head>
  <body>
    
    <div id="container">
    </div>
  </body>
</html>
